# polarIFy

polarIFy is a Python package that transforms python functions into polars expressions.

```python
@polarify
def complicated_row_operation(x: int) -> int:
    k = 0
    c = 2
    if x > 0:
        k = 1
        c = 0
        if x < 10:
            c = 1
    elif x < 0:
        k = -1
    return k * c
```

After adding the `@polarify` decorator to the function, this function will be transformed into a function that uses polars expressions:

```python
def polarified_operation(x: pl.Expr) -> pl.Expr:
    return pl.when(x > 0).then(1).otherwise(
        pl.when(x < 0).then(-1).otherwise(0)
    ) * pl.when(x > 0).then(pl.when(x < 10).then(1).otherwise(0)).otherwise(2)
```

So you can still write readable row-wise python code while the `@polarify` decorator transforms it into a function that works with efficient polars expressions.

## Installation

### conda

```bash
$ conda install -c conda-forge polarify
# or micromamba
$ micromamba install -c conda-forge polarify
# or pixi
$ pixi add polarify
```

### pip

```bash
$ pip install polarify
```

## Usage

```python
import polars as pl
from polarify import polarify

@polarify
def complicated_operation(x: pl.Expr) -> pl.Expr:
    k = 0
    c = 2
    if x > 0:
        k = 1
        c = 0
        if x < 10:
            c = 1
    elif x < 0:
        k = -1
    return k * c


df = pl.DataFrame({"x": [-1, 1, 5, 10]})
result = df.select(pl.col("x"), complicated_operation(pl.col("x")))
print(result)
# shape: (4, 2)
# ┌─────┬─────────┐
# │ x   ┆ literal │
# │ --- ┆ ---     │
# │ i64 ┆ i32     │
# ╞═════╪═════════╡
# │ -1  ┆ -2      │
# │ 1   ┆ 1       │
# │ 5   ┆ 1       │
# │ 10  ┆ 0       │
# └─────┴─────────┘
```

TODO: complicated example with nested functions

### Supported operations

- `if/else/elif` statements
- binary operations (like `+`, `==`, `>`, `&`, `|`, ...)
- unary operations (like `~`, `-`, `not`, ...) (TODO)
- assignments (like `x = 1`)
- polars expressions (like `pl.col("x")`, TODO)
- side-effect free functions that return a polars expression (can be generated by `@polarify`) (TODO)

### Unsupported operations

- `for` loops
- `while` loops
- `break` statements
- `:=` walrus operator
- `match ... case` statements (TODO)
- functions with side-effects (`print`, `pl.write_csv`, ...)

## Benchmarks

TODO: Add some benchmarks

## Development installation

```bash
$ pixi install
$ pixi run postinstall
$ pixi run test
```
